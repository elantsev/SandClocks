import React from "react";
import s from "./SandClocks.module.css";

function SandClocksSVG({ scale, data1, data2, className, ...rest }) {
  // Базовые размеры приняты из макета.
  // уровень песка и пунктирных линий приходят в компонент числом в пределах шкалы,
  // а в svg идет пропорциональное число в виде абсолютных координат в диапазоне от начала до конца песочных часов (1280=0%, 175=100%)

  const getInt = value => Math.trunc(value);
  const getFrac = value => Math.abs((value % 1).toFixed(1) * 10);

  const getHight = (value, from = 1282, to = 175) =>
    from -
    ((value - scale[0]) / (scale[scale.length - 1] - scale[0])) * (from - to);

  const height1 = getHight(data1.value);
  const height2 = getHight(data2.value);
  const heightDiff = Math.abs((height2 + height1) / 2 + 60);

  const DifferenceBlock = ({ value1, value2 }) => {
    const int = getInt(value2 - value1);
    const frac = getFrac(value2 - value1);

    const percentDiff = (
      ((data2.value - data1.value) / data1.value) *
      100
    ).toFixed();
    return (
      <>
        {/* данные */}
        <text
          x="1000"
          y={heightDiff}
          fill="#ffffff"
          fontSize="160"
          fontWeight="400"
        >
          {int},<tspan fontSize="0.85em">{frac}</tspan>
          <tspan x="1310" fontSize="0.85em">
            ({percentDiff}%)
          </tspan>
        </text>
        {/* вертикальная стрелка */}
        <svg
          width="37"
          height={height1 - height2}
          x="1280"
          y={height2}
          preserveAspectRatio="none"
          viewBox="0 0 37 441"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="0"
            height="0"
            fill="black"
          >
            <rect fill="white" width="0" height="0" />
          </mask>
          <path
            d="M20.2678 0.732233C19.2915 -0.244078 17.7085 -0.244078 16.7322 0.732233L0.82233 16.6421C-0.15398 17.6184 -0.15398 19.2014 0.82233 20.1777C1.79864 21.154 3.38155 21.154 4.35786 20.1777L18.5 6.03553L32.6421 20.1777C33.6184 21.154 35.2014 21.154 36.1777 20.1777C37.154 19.2014 37.154 17.6184 36.1777 16.6421L20.2678 0.732233ZM16.7322 440.268C17.7085 441.244 19.2915 441.244 20.2678 440.268L36.1777 424.358C37.154 423.382 37.154 421.799 36.1777 420.822C35.2014 419.846 33.6184 419.846 32.6421 420.822L18.5 434.964L4.35786 420.822C3.38155 419.846 1.79864 419.846 0.82233 420.822C-0.15398 421.799 -0.15398 423.382 0.82233 424.358L16.7322 440.268ZM16 2.5L16 438.5H21L21 2.5L16 2.5Z"
            fill="white"
          />
        </svg>
      </>
    );
  };

  return (
    <div className={`${s.SandClocks} ${className}`} {...rest}>
      <svg
        width="2214"
        height="1329"
        viewBox="0 0 2214 1329"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <rect width="2214" height="1329" fill="black" />
        <mask
          id="mask1"
          mask-type="alpha"
          maskUnits="userSpaceOnUse"
          x="428"
          y="129"
          width="601"
          height="1200"
        >
          <path
            d="M428.639 129H1028.02C1028.02 729 765.628 580.883 765.628 729C765.628 877.117 1028.02 729 1028.02 1329H428.639C428.638 729 691.028 877.117 691.028 729C691.028 580.883 428.636 729 428.639 129Z"
            fill="#C4C4C4"
          />
        </mask>
        <g mask="url(#mask1)">
          {/* уровень песка в первых часах */}
          <path d={`M433 1282 h600 V${height1} h-600`} fill="#00E0FF" />
        </g>
        <mask
          id="mask2"
          mask-type="alpha"
          maskUnits="userSpaceOnUse"
          x="1579"
          y="129"
          width="600"
          height="1200"
        >
          <path
            d="M1579.16 129H2178.54C2178.54 729 1916.15 580.883 1916.15 729C1916.15 877.117 2178.54 729 2178.54 1329H1579.16C1579.16 729 1841.55 877.117 1841.55 729C1841.55 580.883 1579.16 729 1579.16 129Z"
            fill="#C4C4C4"
          />
        </mask>
        <g mask="url(#mask2)">
          {/* уровень песка во вторых часах */}
          <path d={`M1578 1282 h600 V${height2} h-600`} fill="#00E0FF" />
        </g>
        <path
          d="M1029.02 131.5C1028.65 429.32 963.303 540.927 898.694 596.562C882.452 610.548 866.192 621.053 850.879 630.118C845.662 633.205 840.526 636.142 835.53 638.998C825.944 644.479 816.874 649.664 808.747 655.055C796.315 663.302 785.739 672.242 778.295 683.962C770.826 695.722 766.631 710.09 766.631 729C766.631 747.91 770.826 762.278 778.295 774.038C785.739 785.759 796.315 794.698 808.747 802.945C816.874 808.337 825.944 813.522 835.53 819.002C840.526 821.858 845.662 824.795 850.879 827.883C866.192 836.947 882.452 847.452 898.694 861.438C963.303 917.073 1028.65 1028.68 1029.02 1326.5H434.643C435.006 1028.68 500.358 917.073 564.967 861.438C581.209 847.452 597.469 836.947 612.782 827.883C617.999 824.795 623.135 821.858 628.132 819.002C637.717 813.521 646.787 808.337 654.914 802.945C667.346 794.698 677.922 785.759 685.366 774.038C692.835 762.278 697.03 747.91 697.03 729C697.03 710.09 692.835 695.722 685.366 683.962C677.922 672.242 667.346 663.302 654.914 655.055C646.786 649.664 637.717 644.479 628.131 638.998C623.135 636.142 617.998 633.205 612.781 630.118C597.468 621.054 581.208 610.548 564.966 596.562C500.356 540.927 435.005 429.321 434.643 131.5H1029.02Z"
          fill="#00E0FF"
          fillOpacity="0.2"
          stroke="#00E0FF"
          strokeWidth="5"
          strokeLinejoin="round"
        />
        <rect
          x="398.679"
          y="131.539"
          width="666.303"
          height="43"
          rx="17.5"
          fill="black"
          stroke="#00E0FF"
          strokeWidth="5"
          strokeLinejoin="round"
        />
        <rect
          x="398.679"
          y="1283.38"
          width="666.303"
          height="43"
          rx="17.5"
          fill="black"
          stroke="#00E0FF"
          strokeWidth="5"
          strokeLinejoin="round"
        />
        <path
          d="M2175.54 131.5C2175.17 429.32 2109.82 540.927 2045.21 596.562C2028.97 610.548 2012.71 621.053 1997.4 630.117C1992.18 633.205 1987.04 636.142 1982.05 638.998C1972.46 644.479 1963.39 649.664 1955.26 655.055C1942.83 663.302 1932.26 672.241 1924.81 683.962C1917.34 695.722 1913.15 710.09 1913.15 729C1913.15 747.91 1917.34 762.278 1924.81 774.038C1932.26 785.759 1942.83 794.698 1955.26 802.945C1963.39 808.337 1972.46 813.521 1982.05 819.002C1987.04 821.858 1992.18 824.795 1997.4 827.883C2012.71 836.947 2028.97 847.452 2045.21 861.438C2109.82 917.073 2175.17 1028.68 2175.54 1326.5H1581.16C1581.52 1028.68 1646.88 917.073 1711.48 861.438C1727.73 847.452 1743.99 836.947 1759.3 827.883C1764.52 824.795 1769.65 821.858 1774.65 819.002C1784.24 813.521 1793.3 808.336 1801.43 802.945C1813.86 794.698 1824.44 785.759 1831.88 774.038C1839.35 762.278 1843.55 747.91 1843.55 729C1843.55 710.09 1839.35 695.722 1831.88 683.962C1824.44 672.241 1813.86 663.302 1801.43 655.055C1793.3 649.664 1784.23 644.479 1774.65 638.998C1769.65 636.142 1764.52 633.205 1759.3 630.117C1743.99 621.053 1727.73 610.548 1711.48 596.562C1646.87 540.927 1581.52 429.32 1581.16 131.5H2175.54Z"
          fill="#00E0FF"
          fillOpacity="0.2"
          stroke="#00E0FF"
          strokeWidth="5"
          strokeLinejoin="round"
        />
        <rect
          x="1545.2"
          y="131.539"
          width="666.303"
          height="43"
          rx="17.5"
          fill="black"
          stroke="#00E0FF"
          strokeWidth="5"
          strokeLinejoin="round"
        />
        <rect
          x="1545.2"
          y="1283.38"
          width="666.303"
          height="43"
          rx="17.5"
          fill="black"
          stroke="#00E0FF"
          strokeWidth="5"
          strokeLinejoin="round"
        />

        {/*  Шкала  */}
        <svg
          width="125"
          y="80"
          viewBox="0 0 125 1082"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            x="250"
            d="M22.8213 402H15.5557V353.836L0.985382 359.188V352.625L21.6885 344.852H22.8213V402ZM72.3526 345.086V351.219H71.0244C65.3994 351.323 60.9203 352.99 57.5869 356.219C54.2536 359.448 52.3265 363.992 51.8057 369.852C54.8005 366.414 58.889 364.695 64.0713 364.695C69.0192 364.695 72.9645 366.44 75.9073 369.93C78.876 373.419 80.3604 377.924 80.3604 383.445C80.3604 389.305 78.7588 393.992 75.5557 397.508C72.3786 401.023 68.1078 402.781 62.7432 402.781C57.3005 402.781 52.8864 400.698 49.501 396.531C46.1156 392.339 44.4229 386.948 44.4229 380.359V377.586C44.4229 367.117 46.6494 359.122 51.1026 353.602C55.5817 348.055 62.2354 345.216 71.0635 345.086H72.3526ZM62.8604 370.711C60.3864 370.711 58.1078 371.453 56.0244 372.938C53.9411 374.422 52.4958 376.284 51.6885 378.523V381.18C51.6885 385.867 52.7432 389.643 54.8526 392.508C56.9619 395.372 59.5922 396.805 62.7432 396.805C65.9984 396.805 68.5505 395.607 70.3994 393.211C72.2744 390.815 73.2119 387.677 73.2119 383.797C73.2119 379.891 72.2614 376.74 70.3604 374.344C68.4854 371.922 65.9854 370.711 62.8604 370.711ZM124.579 377.742C124.579 386.206 123.134 392.495 120.243 396.609C117.353 400.724 112.834 402.781 106.689 402.781C100.621 402.781 96.1286 400.776 93.2119 396.766C90.2953 392.729 88.7849 386.714 88.6807 378.719V369.07C88.6807 360.711 90.126 354.5 93.0166 350.438C95.9073 346.375 100.439 344.344 106.61 344.344C112.73 344.344 117.235 346.31 120.126 350.242C123.017 354.148 124.501 360.19 124.579 368.367V377.742ZM117.353 367.859C117.353 361.74 116.493 357.286 114.774 354.5C113.056 351.688 110.334 350.281 106.61 350.281C102.912 350.281 100.217 351.674 98.5244 354.461C96.8317 357.247 95.9593 361.531 95.9073 367.312V378.875C95.9073 385.021 96.7927 389.565 98.5635 392.508C100.36 395.424 103.069 396.883 106.689 396.883C110.256 396.883 112.899 395.503 114.618 392.742C116.363 389.982 117.274 385.633 117.353 379.695V367.859Z"
            fill="#00E0FF"
          />
          <path
            d="M22.8213 742H15.5557V693.836L0.985382 699.188V692.625L21.6885 684.852H22.8213V742ZM47.3135 713.484L50.2041 685.125H79.3448V691.805H56.3369L54.6182 707.312C57.4047 705.672 60.5687 704.852 64.1104 704.852C69.2927 704.852 73.4073 706.57 76.4541 710.008C79.501 713.419 81.0244 718.042 81.0244 723.875C81.0244 729.734 79.4359 734.357 76.2588 737.742C73.1078 741.102 68.6937 742.781 63.0166 742.781C57.9906 742.781 53.889 741.388 50.7119 738.602C47.5349 735.815 45.725 731.961 45.2823 727.039H52.1182C52.5609 730.294 53.7198 732.755 55.5948 734.422C57.4698 736.062 59.9437 736.883 63.0166 736.883C66.376 736.883 69.0062 735.737 70.9073 733.445C72.8343 731.154 73.7979 727.99 73.7979 723.953C73.7979 720.151 72.7562 717.104 70.6729 714.812C68.6156 712.495 65.8682 711.336 62.4307 711.336C59.2797 711.336 56.8057 712.026 55.0088 713.406L53.0948 714.969L47.3135 713.484ZM124.579 717.742C124.579 726.206 123.134 732.495 120.243 736.609C117.353 740.724 112.834 742.781 106.689 742.781C100.621 742.781 96.1286 740.776 93.2119 736.766C90.2953 732.729 88.7849 726.714 88.6807 718.719V709.07C88.6807 700.711 90.126 694.5 93.0166 690.438C95.9073 686.375 100.439 684.344 106.61 684.344C112.73 684.344 117.235 686.31 120.126 690.242C123.017 694.148 124.501 700.19 124.579 708.367V717.742ZM117.353 707.859C117.353 701.74 116.493 697.286 114.774 694.5C113.056 691.688 110.334 690.281 106.61 690.281C102.912 690.281 100.217 691.674 98.5244 694.461C96.8317 697.247 95.9593 701.531 95.9073 707.312V718.875C95.9073 725.021 96.7927 729.565 98.5635 732.508C100.36 735.424 103.069 736.883 106.689 736.883C110.256 736.883 112.899 735.503 114.618 732.742C116.363 729.982 117.274 725.633 117.353 719.695V707.859Z"
            fill="#00E0FF"
          />
          <path
            d="M22.8213 1081H15.5557V1032.84L0.985382 1038.19V1031.62L21.6885 1023.85H22.8213V1081ZM74.501 1061.9H82.3916V1067.8H74.501V1081H67.2354V1067.8H41.3369V1063.54L66.8057 1024.12H74.501V1061.9ZM49.5401 1061.9H67.2354V1034.01L66.376 1035.57L49.5401 1061.9ZM124.579 1056.74C124.579 1065.21 123.134 1071.49 120.243 1075.61C117.353 1079.72 112.834 1081.78 106.689 1081.78C100.621 1081.78 96.1286 1079.78 93.2119 1075.77C90.2953 1071.73 88.7849 1065.71 88.6807 1057.72V1048.07C88.6807 1039.71 90.126 1033.5 93.0166 1029.44C95.9073 1025.38 100.439 1023.34 106.61 1023.34C112.73 1023.34 117.235 1025.31 120.126 1029.24C123.017 1033.15 124.501 1039.19 124.579 1047.37V1056.74ZM117.353 1046.86C117.353 1040.74 116.493 1036.29 114.774 1033.5C113.056 1030.69 110.334 1029.28 106.61 1029.28C102.912 1029.28 100.217 1030.67 98.5244 1033.46C96.8317 1036.25 95.9593 1040.53 95.9073 1046.31V1057.88C95.9073 1064.02 96.7927 1068.57 98.5635 1071.51C100.36 1074.42 103.069 1075.88 106.689 1075.88C110.256 1075.88 112.899 1074.5 114.618 1071.74C116.363 1068.98 117.274 1064.63 117.353 1058.7V1046.86Z"
            fill="#00E0FF"
          />
          <path
            d="M22.7191 58H15.4535V9.83594L0.883163 15.1875V8.625L21.5863 0.851562H22.7191V58ZM80.6097 5.1875L57.055 58H49.4769L72.9535 7.0625H42.1722V1.125H80.6097V5.1875ZM124.477 33.7422C124.477 42.2057 123.032 48.4948 120.141 52.6094C117.25 56.724 112.732 58.7812 106.586 58.7812C100.519 58.7812 96.0264 56.776 93.1097 52.7656C90.1931 48.7292 88.6826 42.7135 88.5785 34.7188V25.0703C88.5785 16.7109 90.0238 10.5 92.9144 6.4375C95.805 2.375 100.336 0.34375 106.508 0.34375C112.628 0.34375 117.133 2.3099 120.024 6.24219C122.914 10.1484 124.399 16.1901 124.477 24.3672V33.7422ZM117.25 23.8594C117.25 17.7396 116.391 13.2865 114.672 10.5C112.953 7.6875 110.232 6.28125 106.508 6.28125C102.81 6.28125 100.115 7.67448 98.4222 10.4609C96.7295 13.2474 95.8571 17.5312 95.805 23.3125V34.875C95.805 41.0208 96.6905 45.5651 98.4613 48.5078C100.258 51.4245 102.966 52.8828 106.586 52.8828C110.154 52.8828 112.797 51.5026 114.516 48.7422C116.261 45.9818 117.172 41.6328 117.25 35.6953V23.8594Z"
            fill="#00E0FF"
          />
        </svg>

        {/* данные */}
        <text x="540" y="100" fill="#00E0FF" fontSize="100">
          {data1.date}
        </text>
        <text x="590" y="400" fill="#ffffff" fontSize="160" fontWeight="400">
          {getInt(data1.value)},
          <tspan fontSize="0.85em">{getFrac(data1.value)}</tspan>
        </text>
        <path
          d={`M150 ${height1} h1400`}
          stroke="#ffffff"
          strokeDasharray="20,20"
          strokeWidth="5"
        />
        <text x="1700" y="100" fill="#00E0FF" fontSize="100">
          {data2.date}
        </text>
        <text x="1680" y="400" fill="#ffffff" fontSize="160" fontWeight="400">
          {getInt(data2.value)},
          <tspan fontSize="0.85em">{getFrac(data2.value)}</tspan>
        </text>
        <path
          d={`M150 ${height2} h2050`}
          stroke="#ffffff"
          strokeDasharray="20,20"
          strokeWidth="5"
        />

        <DifferenceBlock value1={data1.value} value2={data2.value} />
      </svg>
    </div>
  );
}

export default SandClocksSVG;
